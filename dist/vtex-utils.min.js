/*!!
 * VtexUtils.js v0.7.0
 * https://github.com/zeindelf/vtex-utils
 *
 * Copyright (c) 2017-2018 Zeindelf
 * Released under the MIT license
 *
 * Date: 2018-02-12T20:13:13.321Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e.VTEX=e.VTEX||{},e.VTEX.VtexUtils=t())}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},a=Object.prototype.toString,o={isArguments:function(t){return"[object Arguments]"===a.call(t)||null!=t&&"object"===(void 0===t?"undefined":e(t))&&"callee"in t},isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===a.call(e)},isBoolean:function(e){return!0===e||!1===e||"[object Boolean]"===a.call(e)},isChar:function(e){return this.isString(e)&&1===e.length},isDate:function(e){return"[object Date]"===a.call(e)},isDomNode:function(e){return this.isObject(e)&&e.nodeType>0},isEmail:function(e){return/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e)},isEmpty:function(e){if(this.isObject(e)){var t=Object.getOwnPropertyNames(e).length;return!!(0===t||1===t&&this.isArray(e)||2===t&&this.isArguments(e))}return""===e},isError:function(e){return"[object Error]"===a.call(e)},isFunction:function(e){return"[object Function]"===a.call(e)||"function"==typeof e},isJson:function(e){try{var t=JSON.parse(e);return this.isObject(t)}catch(e){}return!1},isNull:function(e){return null===e},isNumber:function(e){var t=Number.isNaN||window.isNaN;return"number"==typeof e&&!t(e)},isObject:function(t){return"object"===(void 0===t?"undefined":e(t))&&null!==t},isObjectEmpty:function(e){if(!this.isObject(e))return!1;for(var t in e)if({}.hasOwnProperty.call(e,t))return!1;return!0},isPlainObject:function(e){if(!this.isObject(e))return!1;try{var t=e.constructor,r=t.prototype;return t&&r&&hasOwnProperty.call(r,"isPrototypeOf")}catch(e){return!1}},isRegexp:function(e){return"[object RegExp]"===a.call(e)},isSameType:function(e,t){return a.call(e)===a.call(t)},isString:function(e){return"[object String]"===a.call(e)},isUndefined:function(e){return void 0===e}},s=Array.prototype.slice,u={arrayUnique:function(e){return e.filter(function(e,t,r){return r.indexOf(e)===t})},capitalize:function(e){return e.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},chunk:function(e,t){if(o.isNull(t)||this.lenght(t)<1)return[];for(var r=[],n=0,i=e.length;n<i;)r.push(s.call(e,n,n+=t));return r},cleanArray:function(e){for(var t=[],r=0,n=e.length;r<n;r+=1)e[r]&&t.push(e[r]);return t},contains:function(e,t){if(o.isArray(t))for(var r=0,n=t.length;r<n;r+=1)if(t[r]===e)return!0;return!!o.isString(t)&&t.indexOf(e)>=0},escape:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2F;").replace(/\\/g,"&#x5C;").replace(/`/g,"&#96;")},extend:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(o.isObject(e)&&r.length>0){if(Object.assign)return Object.assign.apply(Object,[e].concat(i(r)));r.forEach(function(t){o.isObject(t)&&Object.keys(t).forEach(function(r){e[r]=t[r]})})}return e},getUrlParameter:function(e,t){t=o.isString(t)?t:window.location.href,e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},implode:function(e,t){if(o.isArray(e))return e.join(t||",");if(o.isObject(e)){var r=[];for(var n in e)object.hasOwnProperty(n)&&r.push(e[n]);return r.join(t||",")}return""},length:function(e){return o.isUndefined(e.length)?o.isObject(e)?Object.keys(e).length:0:e.length},objectSearch:function(e,t){var r=void 0,n=void 0,i=void 0,a=void 0;for(r in t)t.hasOwnProperty(r)&&(n=r,i=t[r]);for(r in e)if(r===n){if(e[r]===i)return e}else if(e[r]instanceof Object&&e.hasOwnProperty(r)&&(a=this.objectSearch(e[r],t)))return a;return!1},removeAccent:function(e){var t=/[àáâãäçèéêëìíîïñòóôõöùúûüýÿÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ]/g;return e.replace(t,function(e){return"_aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY"[t.source.indexOf(e)]})},shuffleArray:function(e){for(var t=0,r=[],n=[],i=e.length-1;i>0;i--)t=Math.floor(Math.random()*(i+1)),r=e[i],n[i]=e[t],n[t]=r;return n},slugifyText:function(e){e=e.replace(/^\s+|\s+$/g,"").toLowerCase().replace(/\./g,"-").replace(/\*/g,"-").replace(/\+/g,"-");for(var t="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",r=0,n=t.length;r<n;r+=1)e=e.replace(new RegExp(t.charAt(r),"g"),"aaaaeeeeiiiioooouuuunc------".charAt(r));return"-"===(e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")).charAt(0)&&(e=e.substr(1)),"-"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),e},stripHost:function(e){return e.toString().replace(/https?:\/\/.*?\//i,"/")},stripHttp:function(e){return e.replace(/^https?:/,"")},strReplace:function(e,t,r){var n=void 0;if(o.isArray(e))for(var i=0;i<e.length;i++)e[i]=e[i].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(e[i],"g"),r=r.replace(n,o.isArray(t)?t[i]:t);else e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(e,"g"),r=r.replace(n,o.isArray(t)?t[0]:t);return r},unescape:function(e){return e.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#x2F;/g,"/").replace(/&#x5C;/g,"\\").replace(/&#96;/g,"`")},unserialize:function(e){if((e=o.isString(e)?e:window.location.href).indexOf("?")<0)return{};for(var t={},r=(e=0===e.indexOf("?")?e.substr(1):e.slice(e.indexOf("?")+1)).split("&"),n=0,i=r.length;n<i;n+=1){var a=r[n].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1]||"")}return t}},c={formatPrice:function(e,t,r,n,i){i=o.isString(i)?i:"R$ ";var a="\\d(?=(\\d{3})+"+((n=o.isNumber(n)?n:2)>0?"\\D":"$")+")";return i+(e=(1*(e/=100)).toFixed(Math.max(0,~~n))).replace(".",r||",").replace(new RegExp(a,"g"),"$&"+(t||"."))},getOriginalImage:function(e){return o.isString(e)?e.replace(/(ids\/[0-9]+)-([0-9-]+)\//,"$1/"):e},getResizedImage:function(e,t,r){return o.isUndefined(t)||o.isUndefined(r)||!o.isString(e)?e:(e=e.replace(/(?:ids\/[0-9]+)-([0-9]+)-([0-9]+)\//,function(e,n,i){return e.replace("-"+n+"-"+i,"-"+t+"-"+r)})).replace(/(ids\/[0-9]+)\//,"$1-"+t+"-"+r+"/")},getServerTime:function(e){return $.ajax({url:"/no-cache/HoraAtualServidor.aspx",type:"get"}).then(function(t){var r=t.match(/([0-9]+):([0-5][0-9]):([0-5][0-9])/)[0],n=parseInt(t.match(/[a-z]{3} ([0-9]{1,2})/)[1]),i=["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"].indexOf(t.match(/[a-z]{3}/)[0])+1,a=parseInt(t.match(/[0-9]{4}/)[0]);n<10&&(n="0"+n),i<10&&(i="0"+i),o.isFunction(e)&&e.call(null,new Date(a+"/"+i+"/"+n+" "+r))})},getCategories:function(e,t){return $.Deferred(function(r){return $.ajax({type:"get",url:"/api/catalog_system/pub/category/tree/"+(t||50),dataType:"json",headers:{accept:"application/json",contentType:"application/json; charset=utf-8"}}).done(function(t){o.isUndefined(e)?r.resolve(t):r.resolve(u.objectSearch(t,{id:e}))}).fail(function(e){return r.reject(e)})}).promise()},replaceBreakLines:function(e){return e=e.replace?e.replace(/(?:\r\n|\r|\n)/g,"<br />"):""},checkLogin:function(){return $.Deferred(function(e){return $.ajax({type:"get",url:"/no-cache/profileSystem/getProfile"}).done(function(t){o.isUndefined(t.IsUserDefined)||!t.IsUserDefined?e.reject(t):e.resolve(t)}).fail(function(t){return e.reject(t)})}).promise()},openPopupLogin:function(e){var t=(e=!!o.isBoolean(e)&&e)?window.location.href:"/";vtexid.start({returnUrl:t})},addToCart:function(e,t,r){if(!o.isArray(e))throw new TypeError("Items must be an Array of Object(s) with item(s) to add, e.g. var items = [{id: 123, quantity: 1, seller: '1'}, {id: 321, quantity: 2, seller: '1'}]");if(u.length(e)<1)throw new Error("Items can't be an empty Array.");return t=o.isUndefined(t)?null:t,r=o.isUndefined?1:r,$.Deferred(function(n){return vtexjs.checkout.getOrderForm().done(function(){return vtexjs.checkout.addToCart(e,t,r).done(function(e){return n.resolve(e)}).fail(function(e){return n.reject()})}).fail(function(e){return n.reject(e)})}).promise()},clearCart:function(){return $.Deferred(function(e){vtexjs.checkout.getOrderForm().done(function(t){return t.items.length?vtexjs.checkout.removeAllItems(t.items).done(function(t){return e.resolve(t)}):e.resolve(t)}).fail(function(t){return e.reject(t)})}).promise()}},f=arguments;"rivets"in window&&(rivets.formatters["!"]=function(e){return!e},rivets.formatters.eq=function(e,t){return e===t},rivets.formatters.neq=function(e,t){return e!==t},rivets.formatters.gt=function(e,t){return e>t},rivets.formatters.gte=function(e,t){return e>=t},rivets.formatters.lt=function(e,t){return e<t},rivets.formatters.lte=function(e,t){return e<=t},rivets.formatters.or=function(e,t){return e||t},rivets.formatters.isEmpty=function(e){return void 0===e||null===e||"string"==typeof e&&0===e.length},rivets.formatters.isNotEmpty=function(e){return!rivets.formatters.isEmpty(e)},rivets.formatters.pass=function(e,t){return t},rivets.formatters.json=function(e,t){return JSON.stringify(e,null,t||0)},rivets.formatters.prefix=function(e,t){return""+t+e},rivets.formatters.suffix=function(e,t){return""+e+t},rivets.formatters.ucFirst=function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},rivets.formatters["+"]=function(e,t){return e+t},rivets.formatters["-"]=function(e,t){return e-t},rivets.formatters["*"]=function(e,t){return e*t},rivets.formatters["/"]=function(e,t){return e/t},rivets.formatters.round=function(e,t){if(t){var r=Math.pow(10,t);e=Math.round(e*r)/r}else e=Math.round(e);return e},rivets.formatters.get=function(t,r){return t&&"object"===(void 0===t?"undefined":e(t))?t[r]:null},rivets.formatters.set=function(t,r,n){return t&&"object"===(void 0===t?"undefined":e(t))&&(t[r]=n),t},rivets.formatters["."]=rivets.formatters.get,rivets.formatters.keys=function(t){return"object"===(void 0===t?"undefined":e(t))?Object.keys(t):[]},rivets.formatters.length=function(e){return e?e.length||0:0},rivets.formatters.sort=function(){var e=Array.from(f),t=e.shift(),r=e.shift(),n=e.shift();return n||"asc"!=r&&"desc"!=r||(n=r,r=null),r?t.sort(function(e,t){return e[r]===t[r]?0:e[r]<t[r]?-1:1}):t.sort(),"desc"==n&&t.reverse(),t},rivets.formatters.default=function(e,t){return void 0!==e&&null!==e?e:t},rivets.formatters.contains=function(e,t){return!!Array.isArray(e)&&-1!==e.indexOf(t)},rivets.formatters.percent=function(e,t){return number_format(100*e,t||0,",")+"%"},rivets.formatters.bind=function(){var e=Array.from(f),t=e.shift(),r=e.shift();return"function"==typeof t?function(){t.apply(r,e)}:t},rivets.formatters.with=function(){var e=Array.from(f),t=e.shift();return"function"==typeof t?t.bind(null,e):t},rivets.formatters.slice=function(){var e=Array.from(f),t=e.shift();return Array.prototype.slice.apply(t,e)},rivets.formatters.formatPrice=function(e){return c.formatPrice(e)},rivets.formatters.productImgSize=function(e,t,r){return c.getResizedImage(e,t,r)});var l={version:"2.7.0",areas:{},apis:{},inherit:function(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r]);return t},stringify:function(e){return void 0===e||"function"==typeof e?e+"":JSON.stringify(e)},parse:function(e){try{return JSON.parse(e)}catch(t){return e}},fn:function(e,t){l.storeAPI[e]=t;for(var r in l.apis)l.apis[r][e]=t},get:function(e,t){return e.getItem(t)},set:function(e,t,r){e.setItem(t,r)},remove:function(e,t){e.removeItem(t)},key:function(e,t){return e.key(t)},length:function(e){return e.length},clear:function(e){e.clear()},Store:function(e,t,r){var n=l.inherit(l.storeAPI,function(e,t,r){return 0===arguments.length?n.getAll():"function"==typeof t?n.transact(e,t,r):void 0!==t?n.set(e,t,r):"string"==typeof e||"number"==typeof e?n.get(e):e?n.setAll(e,t):n.clear()});n._id=e;try{var i="_safariPrivate_";t.setItem(i,"sucks"),n._area=t,t.removeItem(i)}catch(e){}return n._area||(n._area=l.inherit(l.storageAPI,{items:{},name:"fake"})),n._ns=r||"",l.areas[e]||(l.areas[e]=n._area),l.apis[n._ns+n._id]||(l.apis[n._ns+n._id]=n),n},storeAPI:{area:function(e,t){var r=this[e];return r&&r.area||(r=l.Store(e,t,this._ns),this[e]||(this[e]=r)),r},namespace:function(e,t){if(!e)return this._ns?this._ns.substring(0,this._ns.length-1):"";var r=e,n=this[r];return n&&n.namespace||(n=l.Store(this._id,this._area,this._ns+r+"."),this[r]||(this[r]=n),t||n.area("session",l.areas.session)),n},isFake:function(){return"fake"===this._area.name},toString:function(){return"store"+(this._ns?"."+this.namespace():"")+"["+this._id+"]"},has:function(e){return this._area.has?this._area.has(this._in(e)):!!(this._in(e)in this._area)},size:function(){return this.keys().length},each:function(e,t){for(var r=0,n=l.length(this._area);r<n;r++){var i=this._out(l.key(this._area,r));if(void 0!==i&&!1===e.call(this,i,t||this.get(i)))break;n>l.length(this._area)&&(n--,r--)}return t||this},keys:function(e){return this.each(function(e,t){t.push(e)},e||[])},get:function(e,t){var r=l.get(this._area,this._in(e));return null!==r?l.parse(r):t||r},getAll:function(e){return this.each(function(e,t){t[e]=this.get(e)},e||{})},transact:function(e,t,r){var n=this.get(e,r),i=t(n);return this.set(e,void 0===i?n:i),this},set:function(e,t,r){var n=this.get(e);return null!=n&&!1===r?t:l.set(this._area,this._in(e),l.stringify(t),r)||n},setAll:function(e,t){var r,n;for(var i in e)n=e[i],this.set(i,n,t)!==n&&(r=!0);return r},add:function(t,r){var n=this.get(t);if(n instanceof Array)r=n.concat(r);else if(null!==n){var i=void 0===n?"undefined":e(n);if(i===(void 0===r?"undefined":e(r))&&"object"===i){for(var a in r)n[a]=r[a];r=n}else r=n+r}return l.set(this._area,this._in(t),l.stringify(r)),r},remove:function(e){var t=this.get(e);return l.remove(this._area,this._in(e)),t},clear:function(){return this._ns?this.each(function(e){l.remove(this._area,this._in(e))},1):l.clear(this._area),this},clearAll:function(){var e=this._area;for(var t in l.areas)l.areas.hasOwnProperty(t)&&(this._area=l.areas[t],this.clear());return this._area=e,this},_in:function(e){return"string"!=typeof e&&(e=l.stringify(e)),this._ns?this._ns+e:e},_out:function(e){return this._ns?e&&0===e.indexOf(this._ns)?e.substring(this._ns.length):void 0:e}},storageAPI:{length:0,has:function(e){return this.items.hasOwnProperty(e)},key:function(e){var t=0;for(var r in this.items)if(this.has(r)&&e===t++)return r},setItem:function(e,t){this.has(e)||this.length++,this.items[e]=t},removeItem:function(e){this.has(e)&&(delete this.items[e],this.length--)},getItem:function(e){return this.has(e)?this.items[e]:null},clear:function(){for(var e in this.items)this.removeItem(e)},toString:function(){return this.length+" items in "+this.name+"Storage"}}},h=l.Store("local",function(){try{return localStorage}catch(e){}}());h.local=h,h._=l,h.area("session",function(){try{return sessionStorage}catch(e){}}());var d=function(){function e(){t(this,e)}return r(e,[{key:"formatPrice",value:function(e,t,r,n,i){return c.formatPrice(e,t,r,n,i)}},{key:"isValidPrice",value:function(e,t,r,n){return c.isValidPrice(e,t,r,n)}},{key:"getOriginalImage",value:function(e){return c.getOriginalImage(e)}},{key:"getResizedImage",value:function(e,t,r){return c.getResizedImage(e,t,r)}},{key:"getServerTime",value:function(e){return c.getServerTime(e)}},{key:"getCategories",value:function(e,t){return c.getCategories(e,t)}},{key:"replaceBreakLines",value:function(e){return c.replaceBreakLines(e)}},{key:"checkLogin",value:function(){return c.checkLogin()}},{key:"openPopupLogin",value:function(e){return c.openPopupLogin(e)}},{key:"addToCart",value:function(e,t,r){return c.addToCart(e,t,r)}},{key:"clearCart",value:function(){return c.clearCart()}}]),e}(),v=function(){function e(){t(this,e)}return r(e,[{key:"isArguments",value:function(e){return o.isArguments(e)}},{key:"isArray",value:function(e){return o.isArray(e)}},{key:"isBoolean",value:function(e){return o.isBoolean(e)}},{key:"isChar",value:function(e){return o.isChar(e)}},{key:"isDate",value:function(e){return o.isDate(e)}},{key:"isDomNode",value:function(e){return o.isDomNode(e)}},{key:"isEmail",value:function(e){return o.isEmail(e)}},{key:"isEmpty",value:function(e){return o.isEmpty(e)}},{key:"isError",value:function(e){return o.isError(e)}},{key:"isFunction",value:function(e){return o.isFunction(e)}},{key:"isJson",value:function(e){return o.isJson(e)}},{key:"isNull",value:function(e){return o.isNull(e)}},{key:"isNumber",value:function(e){return o.isNumber(e)}},{key:"isObject",value:function(e){return o.isObject(e)}},{key:"isObjectEmpty",value:function(e){return o.isObjectEmpty(e)}},{key:"isPlainObject",value:function(e){return o.isPlainObject(e)}},{key:"isRegexp",value:function(e){return o.isRegexp(e)}},{key:"isSameType",value:function(e,t){return o.isSameType(e,t)}},{key:"isString",value:function(e){return o.isString(e)}},{key:"isUndefined",value:function(e){return o.isUndefined(e)}},{key:"arrayUnique",value:function(e){return u.arrayUnique(e)}},{key:"capitalize",value:function(e){return u.capitalize(e)}},{key:"cleanArray",value:function(e){return u.cleanArray(e)}},{key:"escape",value:function(e){return u.escape(e)}},{key:"extend",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return u.extend.apply(u,[e].concat(r))}},{key:"getUrlParameter",value:function(e,t){return u.getUrlParameter(e,t)}},{key:"implode",value:function(e,t){return u.implode(e,t)}},{key:"length",value:function(e){return u.length(e)}},{key:"objectSearch",value:function(e,t){return u.objectSearch(e,t)}},{key:"removeAccent",value:function(e){return u.removeAccent(e)}},{key:"shuffleArray",value:function(e){return u.shuffleArray(e)}},{key:"slugifyText",value:function(e){return u.slugifyText(e)}},{key:"stripHost",value:function(e){return u.stripHost(e)}},{key:"stripHttp",value:function(e){return u.stripHttp(e)}},{key:"strReplace",value:function(e,t,r){return u.strReplace(e,t,r)}},{key:"unescape",value:function(e){return u.unescape(e)}},{key:"unserialize",value:function(e){return u.unserialize(e)}}]),e}(),p=new(function(){function e(){t(this,e),this._maxParamsPerRequest=50,this._emptyFetchedParams=[],this._pendingParamsToFetch=[],this._fetchedParams=[],this._pendingFetchArray=[],this._errors={searchParamsNotDefined:"Search parameters is not defined",paramsNotAnObject:"Param is not a valid Object",productIdNotDefined:"Product ID is not defined",skuIdNotDefined:"Sku ID is not defined",productIdArrayNotAnArray:"'productIdArray' is not an array",skuIdArrayNotAnArray:"'skuIdArray' is not an array",productIdArrayNotDefined:"'productIdArray' is not an defined",skuIdArrayNotDefined:"'skuIdArray' is not an defined",fqPropertyNotFound:"The property 'fq' was not found"},this._productCacheName="vtexCatalog.productCache",this._skuCacheName="vtexCatalog.skuCache",this._storage=h,this._session=this._storage.session}return r(e,[{key:"_getInstance",value:function(e){this._catalog=e}},{key:"_setSessionCache",value:function(e){this._catalogCache=e,this._initStorage(this._catalogCache)}},{key:"_error",value:function(e){throw new Error(this._errors[e])}},{key:"_initStorage",value:function(e){e?(o.isNull(this._session.get(this._productCacheName))&&this._session.set(this._productCacheName,{}),o.isNull(this._session.get(this._skuCacheName))&&this._session.set(this._skuCacheName,{})):(this._session.remove(this._productCacheName),this._session.remove(this._skuCacheName))}},{key:"_setProductCache",value:function(e){var t=this._session.get(this._productCacheName);for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r]);this._session.set(this._productCacheName,t)}},{key:"_setSkuCache",value:function(e){if(this._catalogCache){var t=this._session.get(this._skuCacheName);for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r]);this._session.set(this._skuCacheName,t)}}},{key:"_getProductCache",value:function(){return this._catalogCache?this._session.get(this._productCacheName):this._catalog.productCache}},{key:"_getSkuCache",value:function(){return this._catalogCache?this._session.get(this._skuCacheName):this._catalog.skusProductIds}},{key:"_setCache",value:function(e){var t=this,r=e.productId,n=e.items;this._catalog.productCache[r]=e,this._catalogCache&&this._setProductCache(this._catalog.productCache),n.forEach(function(e){var n=e.itemId;t._catalog.skusProductIds[n]=r})}},{key:"_search",value:function(e){var t,r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o.isUndefined(e))return this._error("searchParamsNotDefined");if(!o.isObject(e))return this._error("paramsNotAnObject");if(o.isUndefined(e.fq))return this._error("fqPropertyNotFound");var s=$.extend({},e),u=this._pendingFetchArray,c=[];for(var f in e)"map"!==f&&(s[f]=e[f].filter(function(e){return!~r._emptyFetchedParams.indexOf(e)&&(!~r._fetchedParams.indexOf(e)&&(!~r._pendingParamsToFetch.indexOf(e)&&(r._pendingParamsToFetch.push(e),!0)))}));var l=1;o.isArray(e.fq)&&(l=s.fq.length);for(var h=Math.ceil(l/this._maxParamsPerRequest),d=function(e){var t=e*r._maxParamsPerRequest+"-"+((e+1)*r._maxParamsPerRequest-1),n=$.Deferred();$.ajax({url:"/api/catalog_system/pub/products/search/",data:$.param(s,!0),beforeSend:function(e){for(var r in a)({}).hasOwnProperty.call(a,r)&&e.setRequestHeader(r,a[r]);e.setRequestHeader("resources",t)},success:function(e){n.resolve(e)}}),u.push(n.promise())},v=0;v<h;v+=1)d(v);var p=$.Deferred();return p.then(function(){return r._requestSearchStartEvent()}),(t=$).when.apply(t,i(u)).done(function(){for(var t=arguments.length,i=Array(t),a=0;a<t;a++)i[a]=arguments[a];i.forEach(function(e,t){e.forEach(function(e){return r._setCache(e)}),u.splice(t,1)});for(var s in e)({}).hasOwnProperty.call(e,s)&&e[s].forEach(function(e){var t=e.split(":"),i=n(t,2),a=i[0],s=i[1],u=void 0;switch(r._fetchedParams.push(e),a){case"skuId":var f=r._catalog.skusProductIds[s];u=r._catalog.productCache[f];break;case"productId":u=r._catalog.productCache[s]}o.isUndefined(u)?r._emptyFetchedParams.push(e):c.push(u)});c.length?(r._setSkuCache(r._catalog.skusProductIds),p.resolve(c)):p.reject()}),p.promise()}},{key:"_requestSearchStartEvent",value:function(){var e=$.Event("requestSearchStart.vtexCatalog");$(document).trigger(e)}},{key:"_requestProductStartEvent",value:function(){var e=$.Event("requestProductStart.vtexCatalog");$(document).trigger(e)}},{key:"_requestProductEndEvent",value:function(){var e=$.Event("requestProductEnd.vtexCatalog");$(document).trigger(e)}},{key:"_requestSkuStartEvent",value:function(){var e=$.Event("requestSkuStart.vtexCatalog");$(document).trigger(e)}},{key:"_requestSkuEndEvent",value:function(){var e=$.Event("requestSkuEnd.vtexCatalog");$(document).trigger(e)}},{key:"_requestProductArrayStartEvent",value:function(){var e=$.Event("requestProductArrayStart.vtexCatalog");$(document).trigger(e)}},{key:"_requestProductArrayEndEvent",value:function(){var e=$.Event("requestProductArrayEnd.vtexCatalog");$(document).trigger(e)}},{key:"_requestSkuArrayStartEvent",value:function(){var e=$.Event("requestSkuArrayStart.vtexCatalog");$(document).trigger(e)}},{key:"_requestSkuArrayEndEvent",value:function(){var e=$.Event("requestSkuArrayEnd.vtexCatalog");$(document).trigger(e)}}]),e}()),g={_setInstance:function(e){e=!o.isUndefined(e)&&e,p._getInstance(this),p._setSessionCache(e)},getProductCache:function(){return p._getProductCache()},getSkusProductId:function(){return p._getSkuCache()},searchProduct:function(e){if(o.isUndefined(e))return p._error("productIdNotDefined");var t=$.Deferred();t.then(function(){return p._requestProductStartEvent()});var r=p._getProductCache();if(r[e])t.resolve(r[e]);else{var n={fq:["productId:"+e]};p._search(n).done(function(e){return t.resolve(e[0])})}return t.always(function(){return p._requestProductEndEvent()}),t.promise()},searchSku:function(e){if(o.isUndefined(e))return p._error("skuIdNotDefined");var t=$.Deferred();t.then(function(){return p._requestSkuStartEvent()});var r=p._getProductCache(),n=p._getSkuCache();if(n[e])t.resolve(r[n[e]]);else{var i={fq:["skuId:"+e]};p._search(i).done(function(e){return t.resolve(e[0])})}return t.always(function(){return p._requestSkuEndEvent()}),t.promise()},searchProductArray:function(e){if(o.isUndefined(e))return p._error("productIdArrayNotDefined");if(!o.isArray(e))return p._error("productIdArrayNotAnArray");var t=$.Deferred();t.then(function(){return p._requestProductArrayStartEvent()});for(var r={},n={fq:[]},i=p._getProductCache(),a=0,s=e.length;a<s;a+=1)o.isUndefined(i[e[a]])?n.fq.push("productId:"+e[a]):r[e[a]]=i[e[a]];if(n.fq.length){p._search(n).done(function(e){for(var n=0,i=e.length;n<i;n+=1)r[e[n].productId]=e[n];t.resolve(r)})}else t.resolve(r);return t.always(function(){return p._requestProductArrayEndEvent()}),t.promise()},searchSkuArray:function(e){if(o.isUndefined(e))return p._error("skuIdArrayNotDefined");if(!o.isArray(e))return p._error("skuIdArrayNotAnArray");var t=$.Deferred();t.then(function(){return p._requestSkuArrayStartEvent()});for(var r={},n={fq:[]},i=p._getProductCache(),a=p._getSkuCache(),s=0,u=e.length;s<u;s+=1)if(a[e[s]]){var c=a[e[s]];r[c]=i[c]}else n.fq.push("skuId:"+e[s]);if(n.fq.length){p._search(n).done(function(e){for(var n=0,i=e.length;n<i;n+=1)r[e[n].productId]=e[n];t.resolve(r)})}else t.resolve(r);return t.always(function(){return p._requestSkuArrayEndEvent()}),t.promise()},fullSearch:function(e){if(o.isUndefined(e))return p._error("searchParamsNotDefined");if(!o.isObject(e))return p._error("paramsNotAnObject");if(o.isUndefined(e.fq))return p._error("fqPropertyNotFound");for(var t={map:[]},r=0,n=e.fq.length;r<n;r+=1){var i=e.fq[r];if(i.match("C:"))for(var a=i.split("/"),s=0,u=a.length;s<u;s+=1)a[s].match(/\d.+/gi)&&t.map.push("c");i.match(/P\[.+[\d\w\s]?\]/g)&&t.map.push("priceFrom")}t.map=t.map.join(","),$.extend(e,t);return $.ajax({url:"/api/catalog_system/pub/products/search/",data:$.param(e,!0),beforeSend:function(e){e.setRequestHeader("resources","0-49")}})}},y=function e(r){t(this,e),this.productCache={},this.skusProductIds={},u.extend(e.prototype,g),this._setInstance(r)};return function e(){t(this,e),this.version="0.7.0",this.name="@VtexUtils",this.globalHelpers=new v,this.vtexHelpers=new d,this.storage=h,this.VtexCatalog=y}});