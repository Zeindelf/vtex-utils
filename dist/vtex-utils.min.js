/*!!
 * VtexUtils.js v0.7.0
 * https://github.com/zeindelf/vtex-utils
 *
 * Copyright (c) 2017-2018 Zeindelf
 * Released under the MIT license
 *
 * Date: 2018-02-11T22:44:05.895Z
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e.VTEX=e.VTEX||{},e.VTEX.VtexUtils=r())}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),n=function(){return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var t=[],n=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(t.push(s.value),!r||t.length!==r);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}return t}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)},a=Object.prototype.toString,s={isArguments:function(r){return"[object Arguments]"===a.call(r)||null!=r&&"object"===(void 0===r?"undefined":e(r))&&"callee"in r},isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===a.call(e)},isBoolean:function(e){return!0===e||!1===e||"[object Boolean]"===a.call(e)},isChar:function(e){return this.isString(e)&&1===e.length},isDate:function(e){return"[object Date]"===a.call(e)},isDomNode:function(e){return this.isObject(e)&&e.nodeType>0},isEmail:function(e){return/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e)},isEmpty:function(e){if(this.isObject(e)){var r=Object.getOwnPropertyNames(e).length;return!!(0===r||1===r&&this.isArray(e)||2===r&&this.isArguments(e))}return""===e},isError:function(e){return"[object Error]"===a.call(e)},isFunction:function(e){return"[object Function]"===a.call(e)||"function"==typeof e},isJson:function(e){try{var r=JSON.parse(e);return this.isObject(r)}catch(e){}return!1},isNull:function(e){return null===e},isNumber:function(e){var r=Number.isNaN||window.isNaN;return"number"==typeof e&&!r(e)},isObject:function(r){return"object"===(void 0===r?"undefined":e(r))&&null!==r},isObjectEmpty:function(e){if(!this.isObject(e))return!1;for(var r in e)if({}.hasOwnProperty.call(e,r))return!1;return!0},isPlainObject:function(e){if(!this.isObject(e))return!1;try{var r=e.constructor,t=r.prototype;return r&&t&&hasOwnProperty.call(t,"isPrototypeOf")}catch(e){return!1}},isRegexp:function(e){return"[object RegExp]"===a.call(e)},isSameType:function(e,r){return a.call(e)===a.call(r)},isString:function(e){return"[object String]"===a.call(e)},isUndefined:function(e){return void 0===e}},o=Array.prototype.slice,u={arrayUnique:function(e){return e.filter(function(e,r,t){return t.indexOf(e)===r})},capitalize:function(e){return e.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},chunk:function(e,r){if(s.isNull(r)||this.lenght(r)<1)return[];for(var t=[],n=0,i=e.length;n<i;)t.push(o.call(e,n,n+=r));return t},cleanArray:function(e){for(var r=[],t=0,n=e.length;t<n;t+=1)e[t]&&r.push(e[t]);return r},contains:function(e,r){if(s.isArray(r))for(var t=0,n=r.length;t<n;t+=1)if(r[t]===e)return!0;return!!s.isString(r)&&r.indexOf(e)>=0},escape:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2F;").replace(/\\/g,"&#x5C;").replace(/`/g,"&#96;")},extend:function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];if(s.isObject(e)&&t.length>0){if(Object.assign)return Object.assign.apply(Object,[e].concat(i(t)));t.forEach(function(r){s.isObject(r)&&Object.keys(r).forEach(function(t){e[t]=r[t]})})}return e},getUrlParameter:function(e,r){r=s.isString(r)?r:window.location.href,e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(r);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},implode:function(e,r){if(s.isArray(e))return e.join(r||",");if(s.isObject(e)){var t=[];for(var n in e)object.hasOwnProperty(n)&&t.push(e[n]);return t.join(r||",")}return""},length:function(e){return s.isUndefined(e.length)?s.isObject(e)?Object.keys(e).length:0:e.length},objectSearch:function(e,r){var t=void 0,n=void 0,i=void 0,a=void 0;for(t in r)r.hasOwnProperty(t)&&(n=t,i=r[t]);for(t in e)if(t===n){if(e[t]===i)return e}else if(e[t]instanceof Object&&e.hasOwnProperty(t)&&(a=this.objectSearch(e[t],r)))return a;return!1},removeAccent:function(e){var r=/[àáâãäçèéêëìíîïñòóôõöùúûüýÿÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ]/g;return e.replace(r,function(e){return"_aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY"[r.source.indexOf(e)]})},shuffleArray:function(e){for(var r=0,t=[],n=[],i=e.length-1;i>0;i--)r=Math.floor(Math.random()*(i+1)),t=e[i],n[i]=e[r],n[r]=t;return n},slugifyText:function(e){e=e.replace(/^\s+|\s+$/g,"").toLowerCase().replace(/\./g,"-").replace(/\*/g,"-").replace(/\+/g,"-");for(var r="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",t=0,n=r.length;t<n;t+=1)e=e.replace(new RegExp(r.charAt(t),"g"),"aaaaeeeeiiiioooouuuunc------".charAt(t));return"-"===(e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")).charAt(0)&&(e=e.substr(1)),"-"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),e},stripHost:function(e){return e.toString().replace(/https?:\/\/.*?\//i,"/")},stripHttp:function(e){return e.replace(/^https?:/,"")},strReplace:function(e,r,t){var n=void 0;if(s.isArray(e))for(var i=0;i<e.length;i++)e[i]=e[i].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(e[i],"g"),t=t.replace(n,s.isArray(r)?r[i]:r);else e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(e,"g"),t=t.replace(n,s.isArray(r)?r[0]:r);return t},unescape:function(e){return e.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#x2F;/g,"/").replace(/&#x5C;/g,"\\").replace(/&#96;/g,"`")},unserialize:function(e){if((e=s.isString(e)?e:window.location.href).indexOf("?")<0)return{};for(var r={},t=(e=0===e.indexOf("?")?e.substr(1):e.slice(e.indexOf("?")+1)).split("&"),n=0,i=t.length;n<i;n+=1){var a=t[n].split("=");r[decodeURIComponent(a[0])]=decodeURIComponent(a[1]||"")}return r}},c={formatPrice:function(e,r,t,n,i){i=s.isString(i)?i:"R$ ";var a="\\d(?=(\\d{3})+"+((n=s.isNumber(n)?n:2)>0?"\\D":"$")+")";return i+(e=(1*(e/=100)).toFixed(Math.max(0,~~n))).replace(".",t||",").replace(new RegExp(a,"g"),"$&"+(r||"."))},getOriginalImage:function(e){return s.isString(e)?e.replace(/(ids\/[0-9]+)-([0-9-]+)\//,"$1/"):e},getResizedImage:function(e,r,t){return s.isUndefined(r)||s.isUndefined(t)||!s.isString(e)?e:(e=e.replace(/(?:ids\/[0-9]+)-([0-9]+)-([0-9]+)\//,function(e,n,i){return e.replace("-"+n+"-"+i,"-"+r+"-"+t)})).replace(/(ids\/[0-9]+)\//,"$1-"+r+"-"+t+"/")},getServerTime:function(e){return $.ajax({url:"/no-cache/HoraAtualServidor.aspx",type:"get"}).then(function(r){var t=r.match(/([0-9]+):([0-5][0-9]):([0-5][0-9])/)[0],n=parseInt(r.match(/[a-z]{3} ([0-9]{1,2})/)[1]),i=["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"].indexOf(r.match(/[a-z]{3}/)[0])+1,a=parseInt(r.match(/[0-9]{4}/)[0]);n<10&&(n="0"+n),i<10&&(i="0"+i),s.isFunction(e)&&e.call(null,new Date(a+"/"+i+"/"+n+" "+t))})},getCategories:function(e,r){return $.Deferred(function(t){return $.ajax({type:"get",url:"/api/catalog_system/pub/category/tree/"+(r||50),dataType:"json",headers:{accept:"application/json",contentType:"application/json; charset=utf-8"}}).done(function(r){s.isUndefined(e)?t.resolve(r):t.resolve(u.objectSearch(r,{id:e}))}).fail(function(e){return t.reject(e)})}).promise()},replaceBreakLines:function(e){return e=e.replace?e.replace(/(?:\r\n|\r|\n)/g,"<br />"):""},checkLogin:function(){return $.Deferred(function(e){return $.ajax({type:"get",url:"/no-cache/profileSystem/getProfile"}).done(function(r){s.isUndefined(r.IsUserDefined)||!r.IsUserDefined?e.reject(r):e.resolve(r)}).fail(function(r){return e.reject(r)})}).promise()},openPopupLogin:function(e){var r=(e=!!s.isBoolean(e)&&e)?window.location.href:"/";vtexid.start({returnUrl:r})},addToCart:function(e,r,t){if(!s.isArray(e))throw new TypeError("Items must be an Array of Object(s) with item(s) to add, e.g. var items = [{id: 123, quantity: 1, seller: '1'}, {id: 321, quantity: 2, seller: '1'}]");if(u.length(e)<1)throw new Error("Items can't be an empty Array.");return r=s.isUndefined(r)?null:r,t=s.isUndefined?1:t,$.Deferred(function(n){return vtexjs.checkout.getOrderForm().done(function(){return vtexjs.checkout.addToCart(e,r,t).done(function(e){return n.resolve(e)}).fail(function(e){return n.reject()})}).fail(function(e){return n.reject(e)})}).promise()},clearCart:function(){return $.Deferred(function(e){vtexjs.checkout.getOrderForm().done(function(r){return r.items.length?vtexjs.checkout.removeAllItems(r.items).done(function(r){return e.resolve(r)}):e.resolve(r)}).fail(function(r){return e.reject(r)})}).promise()}},f=arguments;"rivets"in window&&(rivets.formatters["!"]=function(e){return!e},rivets.formatters.eq=function(e,r){return e===r},rivets.formatters.neq=function(e,r){return e!==r},rivets.formatters.gt=function(e,r){return e>r},rivets.formatters.gte=function(e,r){return e>=r},rivets.formatters.lt=function(e,r){return e<r},rivets.formatters.lte=function(e,r){return e<=r},rivets.formatters.or=function(e,r){return e||r},rivets.formatters.isEmpty=function(e){return void 0===e||null===e||"string"==typeof e&&0===e.length},rivets.formatters.isNotEmpty=function(e){return!rivets.formatters.isEmpty(e)},rivets.formatters.pass=function(e,r){return r},rivets.formatters.json=function(e,r){return JSON.stringify(e,null,r||0)},rivets.formatters.prefix=function(e,r){return""+r+e},rivets.formatters.suffix=function(e,r){return""+e+r},rivets.formatters.ucFirst=function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},rivets.formatters["+"]=function(e,r){return e+r},rivets.formatters["-"]=function(e,r){return e-r},rivets.formatters["*"]=function(e,r){return e*r},rivets.formatters["/"]=function(e,r){return e/r},rivets.formatters.round=function(e,r){if(r){var t=Math.pow(10,r);e=Math.round(e*t)/t}else e=Math.round(e);return e},rivets.formatters.get=function(r,t){return r&&"object"===(void 0===r?"undefined":e(r))?r[t]:null},rivets.formatters.set=function(r,t,n){return r&&"object"===(void 0===r?"undefined":e(r))&&(r[t]=n),r},rivets.formatters["."]=rivets.formatters.get,rivets.formatters.keys=function(r){return"object"===(void 0===r?"undefined":e(r))?Object.keys(r):[]},rivets.formatters.length=function(e){return e?e.length||0:0},rivets.formatters.sort=function(){var e=Array.from(f),r=e.shift(),t=e.shift(),n=e.shift();return n||"asc"!=t&&"desc"!=t||(n=t,t=null),t?r.sort(function(e,r){return e[t]===r[t]?0:e[t]<r[t]?-1:1}):r.sort(),"desc"==n&&r.reverse(),r},rivets.formatters.default=function(e,r){return void 0!==e&&null!==e?e:r},rivets.formatters.contains=function(e,r){return!!Array.isArray(e)&&-1!==e.indexOf(r)},rivets.formatters.percent=function(e,r){return number_format(100*e,r||0,",")+"%"},rivets.formatters.bind=function(){var e=Array.from(f),r=e.shift(),t=e.shift();return"function"==typeof r?function(){r.apply(t,e)}:r},rivets.formatters.with=function(){var e=Array.from(f),r=e.shift();return"function"==typeof r?r.bind(null,e):r},rivets.formatters.slice=function(){var e=Array.from(f),r=e.shift();return Array.prototype.slice.apply(r,e)},rivets.formatters.formatPrice=function(e){return c.formatPrice(e)},rivets.formatters.productImgSize=function(e,r,t){return c.getResizedImage(e,r,t)});var l={version:"2.7.0",areas:{},apis:{},inherit:function(e,r){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t]);return r},stringify:function(e){return void 0===e||"function"==typeof e?e+"":JSON.stringify(e)},parse:function(e){try{return JSON.parse(e)}catch(r){return e}},fn:function(e,r){l.storeAPI[e]=r;for(var t in l.apis)l.apis[t][e]=r},get:function(e,r){return e.getItem(r)},set:function(e,r,t){e.setItem(r,t)},remove:function(e,r){e.removeItem(r)},key:function(e,r){return e.key(r)},length:function(e){return e.length},clear:function(e){e.clear()},Store:function(e,r,t){var n=l.inherit(l.storeAPI,function(e,r,t){return 0===arguments.length?n.getAll():"function"==typeof r?n.transact(e,r,t):void 0!==r?n.set(e,r,t):"string"==typeof e||"number"==typeof e?n.get(e):e?n.setAll(e,r):n.clear()});n._id=e;try{var i="_safariPrivate_";r.setItem(i,"sucks"),n._area=r,r.removeItem(i)}catch(e){}return n._area||(n._area=l.inherit(l.storageAPI,{items:{},name:"fake"})),n._ns=t||"",l.areas[e]||(l.areas[e]=n._area),l.apis[n._ns+n._id]||(l.apis[n._ns+n._id]=n),n},storeAPI:{area:function(e,r){var t=this[e];return t&&t.area||(t=l.Store(e,r,this._ns),this[e]||(this[e]=t)),t},namespace:function(e,r){if(!e)return this._ns?this._ns.substring(0,this._ns.length-1):"";var t=e,n=this[t];return n&&n.namespace||(n=l.Store(this._id,this._area,this._ns+t+"."),this[t]||(this[t]=n),r||n.area("session",l.areas.session)),n},isFake:function(){return"fake"===this._area.name},toString:function(){return"store"+(this._ns?"."+this.namespace():"")+"["+this._id+"]"},has:function(e){return this._area.has?this._area.has(this._in(e)):!!(this._in(e)in this._area)},size:function(){return this.keys().length},each:function(e,r){for(var t=0,n=l.length(this._area);t<n;t++){var i=this._out(l.key(this._area,t));if(void 0!==i&&!1===e.call(this,i,r||this.get(i)))break;n>l.length(this._area)&&(n--,t--)}return r||this},keys:function(e){return this.each(function(e,r){r.push(e)},e||[])},get:function(e,r){var t=l.get(this._area,this._in(e));return null!==t?l.parse(t):r||t},getAll:function(e){return this.each(function(e,r){r[e]=this.get(e)},e||{})},transact:function(e,r,t){var n=this.get(e,t),i=r(n);return this.set(e,void 0===i?n:i),this},set:function(e,r,t){var n=this.get(e);return null!=n&&!1===t?r:l.set(this._area,this._in(e),l.stringify(r),t)||n},setAll:function(e,r){var t,n;for(var i in e)n=e[i],this.set(i,n,r)!==n&&(t=!0);return t},add:function(r,t){var n=this.get(r);if(n instanceof Array)t=n.concat(t);else if(null!==n){var i=void 0===n?"undefined":e(n);if(i===(void 0===t?"undefined":e(t))&&"object"===i){for(var a in t)n[a]=t[a];t=n}else t=n+t}return l.set(this._area,this._in(r),l.stringify(t)),t},remove:function(e){var r=this.get(e);return l.remove(this._area,this._in(e)),r},clear:function(){return this._ns?this.each(function(e){l.remove(this._area,this._in(e))},1):l.clear(this._area),this},clearAll:function(){var e=this._area;for(var r in l.areas)l.areas.hasOwnProperty(r)&&(this._area=l.areas[r],this.clear());return this._area=e,this},_in:function(e){return"string"!=typeof e&&(e=l.stringify(e)),this._ns?this._ns+e:e},_out:function(e){return this._ns?e&&0===e.indexOf(this._ns)?e.substring(this._ns.length):void 0:e}},storageAPI:{length:0,has:function(e){return this.items.hasOwnProperty(e)},key:function(e){var r=0;for(var t in this.items)if(this.has(t)&&e===r++)return t},setItem:function(e,r){this.has(e)||this.length++,this.items[e]=r},removeItem:function(e){this.has(e)&&(delete this.items[e],this.length--)},getItem:function(e){return this.has(e)?this.items[e]:null},clear:function(){for(var e in this.items)this.removeItem(e)},toString:function(){return this.length+" items in "+this.name+"Storage"}}},h=l.Store("local",function(){try{return localStorage}catch(e){}}());h.local=h,h._=l,h.area("session",function(){try{return sessionStorage}catch(e){}}());var d=function(){function e(){r(this,e)}return t(e,[{key:"formatPrice",value:function(e,r,t,n,i){return c.formatPrice(e,r,t,n,i)}},{key:"isValidPrice",value:function(e,r,t,n){return c.isValidPrice(e,r,t,n)}},{key:"getOriginalImage",value:function(e){return c.getOriginalImage(e)}},{key:"getResizedImage",value:function(e,r,t){return c.getResizedImage(e,r,t)}},{key:"getServerTime",value:function(e){return c.getServerTime(e)}},{key:"getCategories",value:function(e,r){return c.getCategories(e,r)}},{key:"replaceBreakLines",value:function(e){return c.replaceBreakLines(e)}},{key:"checkLogin",value:function(){return c.checkLogin()}},{key:"openPopupLogin",value:function(e){return c.openPopupLogin(e)}},{key:"addToCart",value:function(e,r,t){return c.addToCart(e,r,t)}},{key:"clearCart",value:function(){return c.clearCart()}}]),e}(),p=function(){function e(){r(this,e)}return t(e,[{key:"isArguments",value:function(e){return s.isArguments(e)}},{key:"isArray",value:function(e){return s.isArray(e)}},{key:"isBoolean",value:function(e){return s.isBoolean(e)}},{key:"isChar",value:function(e){return s.isChar(e)}},{key:"isDate",value:function(e){return s.isDate(e)}},{key:"isDomNode",value:function(e){return s.isDomNode(e)}},{key:"isEmail",value:function(e){return s.isEmail(e)}},{key:"isEmpty",value:function(e){return s.isEmpty(e)}},{key:"isError",value:function(e){return s.isError(e)}},{key:"isFunction",value:function(e){return s.isFunction(e)}},{key:"isJson",value:function(e){return s.isJson(e)}},{key:"isNull",value:function(e){return s.isNull(e)}},{key:"isNumber",value:function(e){return s.isNumber(e)}},{key:"isObject",value:function(e){return s.isObject(e)}},{key:"isObjectEmpty",value:function(e){return s.isObjectEmpty(e)}},{key:"isPlainObject",value:function(e){return s.isPlainObject(e)}},{key:"isRegexp",value:function(e){return s.isRegexp(e)}},{key:"isSameType",value:function(e,r){return s.isSameType(e,r)}},{key:"isString",value:function(e){return s.isString(e)}},{key:"isUndefined",value:function(e){return s.isUndefined(e)}},{key:"arrayUnique",value:function(e){return u.arrayUnique(e)}},{key:"capitalize",value:function(e){return u.capitalize(e)}},{key:"cleanArray",value:function(e){return u.cleanArray(e)}},{key:"escape",value:function(e){return u.escape(e)}},{key:"extend",value:function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];return u.extend.apply(u,[e].concat(t))}},{key:"getUrlParameter",value:function(e,r){return u.getUrlParameter(e,r)}},{key:"implode",value:function(e,r){return u.implode(e,r)}},{key:"length",value:function(e){return u.length(e)}},{key:"objectSearch",value:function(e,r){return u.objectSearch(e,r)}},{key:"removeAccent",value:function(e){return u.removeAccent(e)}},{key:"shuffleArray",value:function(e){return u.shuffleArray(e)}},{key:"slugifyText",value:function(e){return u.slugifyText(e)}},{key:"stripHost",value:function(e){return u.stripHost(e)}},{key:"stripHttp",value:function(e){return u.stripHttp(e)}},{key:"strReplace",value:function(e,r,t){return u.strReplace(e,r,t)}},{key:"unescape",value:function(e){return u.unescape(e)}},{key:"unserialize",value:function(e){return u.unserialize(e)}}]),e}(),v=new(function(){function a(){r(this,a),this._maxParamsPerRequest=50,this._emptyFetchedParams=[],this._pendingParamsToFetch=[],this._fetchedParams=[],this._pendingFetchArray=[],this._errors={searchParamsNotDefined:"Search parameters is not defined",paramsNotAnObject:"Param is not a valid Object",productIdNotDefined:"Product ID is not defined",skuIdNotDefined:"Sku ID is not defined",productIdArrayNotAnArray:"'productIdArray' is not an array",skuIdArrayNotAnArray:"'skuIdArray' is not an array",productIdArrayNotDefined:"'productIdArray' is not an defined",skuIdArrayNotDefined:"'skuIdArray' is not an defined",fqPropertyNotFound:"The property 'fq' was not found"}}return t(a,[{key:"_getInstance",value:function(e){this._catalog=e}},{key:"_error",value:function(e){throw new Error(this._errors[e])}},{key:"_setProductCache",value:function(e){var r=this._catalog.session.get(this._catalog.productCacheName);for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t]);this._catalog.session.set(this._catalog.productCacheName,r,10)}},{key:"_search",value:function(r){var t,a=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=function(e){var r=e.productId,t=e.items;a._catalog.productCache[r]=e,a._catalog.sessionCache&&a._setProductCache(a._catalog.productCache),t.forEach(function(e){var t=e.itemId;a._catalog.skusProductIds[t]=r})};if(!r)return this._error("searchParamsNotDefined");if("object"!==(void 0===r?"undefined":e(r)))return this._error("paramsNotAnObject");if(!r.fq)return this._error("fqPropertyNotFound");var u=$.extend({},r),c=this._pendingFetchArray,f=[];for(var l in r)"map"!==l&&(u[l]=r[l].filter(function(e){return!~a._emptyFetchedParams.indexOf(e)&&(!~a._fetchedParams.indexOf(e)&&(!~a._pendingParamsToFetch.indexOf(e)&&(a._pendingParamsToFetch.push(e),!0)))}));var h=1;Array.isArray(r.fq)&&(h=u.fq.length);for(var d=Math.ceil(h/this._maxParamsPerRequest),p=function(e){var r=e*a._maxParamsPerRequest+"-"+((e+1)*a._maxParamsPerRequest-1),t=$.Deferred();$.ajax({url:"/api/catalog_system/pub/products/search/",data:$.param(u,!0),beforeSend:function(e){for(var t in s)({}).hasOwnProperty.call(s,t)&&e.setRequestHeader(t,s[t]);e.setRequestHeader("resources",r)},success:function(e){t.resolve(e)}}),c.push(t.promise())},v=0;v<d;v++)p(v);var g=$.Deferred();return(t=$).when.apply(t,i(c)).done(function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(function(e,r){e.forEach(o),c.splice(r,1)});for(var s in r)({}).hasOwnProperty.call(r,s)&&r[s].forEach(function(e){var r=e.split(":"),t=n(r,2),i=t[0],s=t[1],o=void 0;switch(a._fetchedParams.push(e),i){case"skuId":var u=a._catalog.skusProductIds[s];o=a._catalog.productCache[u];break;case"productId":o=a._catalog.productCache[s]}o?f.push(o):a._emptyFetchedParams.push(e)});f.length?g.resolve(f):g.reject()}).always(function(){return a._requestEndEvent()}),g.promise()}},{key:"_requestEndEvent",value:function(){var e=$.Event("vtexCatalog.requestEnd");$(document).trigger(e)}}]),a}()),g={setInstance:function(){v._getInstance(this)},initStorage:function(){this.sessionCache&&(this.productCacheName="PRODUCTS_CACHE",this.skusCacheName="SKUS_CACHE",this.globalHelpers.isNull(this.session.get(this.productCacheName))&&this.session.set(this.productCacheName,{}),this.globalHelpers.isNull(this.session.get(this.skusCacheName))&&this.session.set(this.skusCacheName,{}))},searchProduct:function(e){if(!e)return v._error("productIdNotDefined");var r=$.Deferred(),t=this.sessionCache?this.session.get(this.productCacheName):this.productCache;if(t[e])r.resolve(t[e]);else{var n={fq:["productId:"+e]};v._search(n).done(function(e){return r.resolve(e[0])})}return r.promise()},searchSku:function(e){if(!e)return v._error("skuIdNotDefined");var r=$.Deferred(),t=this.sessionCache?this.session.get(this.productCacheName):this.productCache;if(this.skusProductIds[e])r.resolve(t[this.skusProductIds[e]]);else{var n={fq:["skuId:"+e]};v._search(n).done(function(e){return r.resolve(e[0])})}return r.promise()},searchProductArray:function(e){if(!e)return v._error("productIdArrayNotDefined");if(!Array.isArray(e))return v._error("productIdArrayNotAnArray");for(var r=$.Deferred(),t={},n={fq:[]},i=this.session.get(this.productCacheName),a=0;a<e.length;a++)void 0===i[e[a]]?n.fq.push("productId:"+e[a]):t[e[a]]=i[e[a]];if(n.fq.length){v._search(n).done(function(e){for(var n=0;n<e.length;n++)t[e[n].productId]=e[n];r.resolve(t)})}else r.resolve(t);return r.promise()},searchSkuArray:function(e){if(!e)return v._error("skuIdArrayNotDefined");if(!Array.isArray(e))return v._error("skuIdArrayNotAnArray");for(var r=$.Deferred(),t={},n={fq:[]},i=0;i<e.length;i++)if(this.skusProductIds[e[i]]){var a=this.skusProductIds[e[i]];t[a]=this.productCache[a]}else n.fq.push("skuId:"+e[i]);if(n.fq.length){v._search(n).done(function(e){for(var n=0;n<e.length;n++)t[e[n].productId]=e[n];r.resolve(t)})}else r.resolve(t);return r.promise()},fullSearch:function(r){if(!r)return v._error("searchParamsNotDefined");if("object"!==(void 0===r?"undefined":e(r)))return v._error("paramsNotAnObject");if(!r.fq)return v._error("fqPropertyNotFound");for(var t={map:[]},n=0;n<r.fq.length;n++){var i=r.fq[n];if(i.match("C:"))for(var a=i.split("/"),s=0;s<a.length;s++)a[s].match(/\d.+/gi)&&t.map.push("c");i.match(/P\[.+[\d\w\s]?\]/g)&&t.map.push("priceFrom")}t.map=t.map.join(","),$.extend(r,t);return $.ajax({url:"/api/catalog_system/pub/products/search/",data:$.param(r,!0),beforeSend:function(e){e.setRequestHeader("resources","0-49")}})}};return function e(){r(this,e),this.version="0.7.0",this.name="@VtexUtils",this.globalHelpers=new p,this.vtexHelpers=new d,this.storage=h,this.vtexCatalog=new function e(t,n,i){r(this,e),this.globalHelpers=t,this.vtexHelpers=n,this.storage=i,this.sessionCache=!0,this.session=this.storage.session,this.productCache={},this.skusProductIds={},this.globalHelpers.extend(e.prototype,g),this.setInstance(),this.initStorage()}(this.globalHelpers,this.vtexHelpers,this.storage)}});